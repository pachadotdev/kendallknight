<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mathematical and Computational Details • kendallknight</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mathematical and Computational Details">
<meta property="og:description" content="kendallknight">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kendallknight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/details.html">Mathematical and Computational Details</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pachadotdev/capybara/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="details_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Mathematical and Computational Details</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pachadotdev/capybara/blob/HEAD/vignettes/details.Rmd" class="external-link"><code>vignettes/details.Rmd</code></a></small>
      <div class="hidden name"><code>details.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Kendall’s correlation coefficient is a non-parametric measure of association between two variables and it is particularly useful to compute pseudo-$R<span class="math inline">\(2\)</span> statistics in the context of Poisson regression with fixed effects <span class="citation">(Silva and Tenreyro 2006)</span>. The current Kendall’s correlation coefficient implementation in R has a computational complexity of <span class="math inline">\(O(n^2)\)</span>, which can be slow for large datasets <span class="citation">(R Core Team 2024)</span>. We used C++ in the <code>kendallknight</code> package to compute the same with a computational complexity <span class="math inline">\(O(n \log(n))\)</span> following <span class="citation">Knight (1966)</span>, <span class="citation">Abrevaya (1999)</span>, <span class="citation">Christensen (2005)</span> and <span class="citation">Emara (2024)</span>. For a dataset with 20,000 observations, a computational complexity <span class="math inline">\(O(n^2)\)</span> involves 400 million operations and a computational complexity <span class="math inline">\(O(n \log(n))\)</span> requires approximately 198,000 operations to obtain the Kendall’s correlation coefficient, meaning that our implementation can reduce computation time by several minutes or hours for large datasets without sacrificing precision or correct handling of corner cases.</p>
</div>
<div class="section level2">
<h2 id="definitions">Definitions<a class="anchor" aria-label="anchor" href="#definitions"></a>
</h2>
<p>Kendall’s correlation coefficient is a pairwise measure of association and it does not require the data to be normally distributed. For two vectors <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> of length <span class="math inline">\(n\)</span>, it is defined as <span class="citation">(Knight 1966)</span>:</p>
<p><span class="math display">\[\begin{equation}
r(x,y) = \frac{c - d}{\sqrt{(c + d + e)(c + d + f)}},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(c\)</span> is the number of concordant pairs, <span class="math inline">\(d\)</span> is the number of discordant pairs, <span class="math inline">\(e\)</span> is the number of ties in <span class="math inline">\(x\)</span> and <span class="math inline">\(f\)</span> is the number of ties in <span class="math inline">\(y\)</span>.</p>
<p>The corresponding definitions for <span class="math inline">\(c\)</span>, <span class="math inline">\(d\)</span>, <span class="math inline">\(e\)</span> and <span class="math inline">\(f\)</span> are:</p>
<p><span class="math display">\[\begin{eqnarray}
c = \sum_{i=1}^{n} \sum_{j \neq i}^{n} g_1(x_i, x_j, y_i, y_j), \\
d = \sum_{i=1}^{n} \sum_{j \neq i}^{n} g_2(x_i, x_j, y_i, y_j]), \\ 
e = \sum_{i=1}^{n} \sum_{j \neq i}^{n} g_3(x_i, x_j) g_4(y_i, y_j), \\
f = \sum_{i=1}^{n} \sum_{j \neq i}^{n} g_4(x_i, x_j) g_3(y_j, y_i).
\end{eqnarray}\]</span></p>
<p>The functions <span class="math inline">\(g_1\)</span>, <span class="math inline">\(g_2\)</span>, <span class="math inline">\(g_3\)</span> and <span class="math inline">\(g_4\)</span> are indicators defined as:</p>
<p><span class="math display">\[\begin{eqnarray}
g_1(x_i, x_j, y_i, y_j) = \begin{cases}
  1 &amp; \text{if } (x_i - x_j)(y_i - y_j) &gt; 0, \\
  0 &amp; \text{otherwise},
\end{cases} \\
g_2(x_i, x_j, y_i, y_j) = \begin{cases}
  1 &amp; \text{if } (x_i - x_j)(y_i - y_j) &lt; 0, \\
  0 &amp; \text{otherwise},
\end{cases} \\
g_3(x_i, x_j) = \begin{cases}
  1 &amp; \text{if } x_i = x_j \text{ and } y_i \neq y_j, \\
  0 &amp; \text{otherwise},
\end{cases} \\
g_4(y_i, y_j) = \begin{cases}
  1 &amp; \text{if } x_i \neq x_j \text{ and } y_i = y_j, \\
  0 &amp; \text{otherwise}.
\end{cases}
\end{eqnarray}\]</span></p>
<p>Kendall’s correlation correlation is a measure of the proportion of concordant pairs minus the proportion of discordant pairs corrected by the proportion of ties in the data, and it requires to compare <span class="math inline">\(m = n(n - 1) / 2\)</span> pairs of observations which is why its computational complexity is <span class="math inline">\(O(n^2)\)</span>.</p>
<p>Without ties, or duplicates in the data, the Kendall’s correlation coefficient simplifies to:</p>
<p><span class="math display">\[\begin{equation}
r(x,y) = \frac{c - d}{c + d} = 
 \frac{c - d}{m} =
 % \frac{2(c - d)}{n(n - 1)} = 
 % \frac{2c}{n(n - 1)} - \frac{2d}{n(n - 1)} =
 % \frac{2c}{n(n - 1)} - \frac{2(m - c)}{n(n - 1)} =
 % \frac{4c}{n(n - 1)} - \frac{2m}{n(n - 1)} =
 % \frac{4c}{n(n - 1)} - \frac{2m}{2m} =
 \frac{4c}{n(n - 1)} - 1
\end{equation}\]</span></p>
<p>A naive implementation consisting in comparing all pairs of observations would require <span class="math inline">\(O(n^2)\)</span> operations. However, the Kendall’s correlation coefficient can be computed more efficiently by sorting the data and using the number of inversions in the data to compute the correlation in <span class="math inline">\(O(n \log(n))\)</span> operations by using binary trees <span class="citation">(Knight 1966)</span>.</p>
<p>An array that represents a binary tree has a search operation with a computational complexity of <span class="math inline">\(O(\log(n))\)</span> and an insertion operation with a computational complexity of <span class="math inline">\(O(n)\)</span> <span class="citation">(Abrevaya 1999; Christensen 2005)</span>. The resulting computational complexity of the search and insert operations in an array is <span class="math inline">\(O(n)\)</span> <span class="citation">(Emara 2024)</span>. Repeating thhe search and insert operation for each element in the array results in a computational complexity of <span class="math inline">\(O(n^2)\)</span>, resulting in the same computational complexity as the naive implementation.</p>
</div>
<div class="section level2">
<h2 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h2>
<p>Using a merge sort with a binary tree with a depth <span class="math inline">\(1 + \log_2(n)\)</span> results in a search and insert operation with a computational complexity of <span class="math inline">\(O(\log(n))\)</span>, resulting in a computational complexity of <span class="math inline">\(O(n \log(n))\)</span> for the Kendall’s correlation coefficient <span class="citation">(Knight 1966; Emara 2024)</span>.</p>
<p>An algorithm that conducts the following operations can compute the Kendall’s correlation coefficient in an efficient way, with computational complexity of <span class="math inline">\(O(n \log(n))\)</span> instead of <span class="math inline">\(O(n^2)\)</span>, as follows:</p>
<ol style="list-style-type: decimal">
<li>Sort the vector <span class="math inline">\(x\)</span> and keep track of the original indices in a permutation vector.</li>
<li>Rearrange the vector <span class="math inline">\(y\)</span> according to <span class="math inline">\(x\)</span>.</li>
<li>Compute the total pairs <span class="math inline">\(m\)</span>.</li>
<li>Compute the pairs of ties in <span class="math inline">\(x\)</span> as <span class="math inline">\(m_x = t_x (t_x + 1) / 2\)</span>.</li>
<li>Compute the pairs of ties in <span class="math inline">\(y\)</span> as <span class="math inline">\(m_y = t_y (t_y + 1) / 2\)</span>.</li>
<li>Compute the concordant pairs adjusted by the number of swaps in <span class="math inline">\(y\)</span> by using a merge sort as <span class="math inline">\(t = m - t_x - t_y + 2t_p\)</span>.</li>
<li>Compute the Kendall’s correlation coefficient as <span class="math inline">\(r(x,y) = t / (\sqrt{m - m_x} \sqrt{m - m_y})\)</span>.</li>
</ol>
<p>The <code>kendallknight</code> package implements these steps in C++ and exports the Kendall’s correlation coeeficient as a function that can be used in R by using the <code>cpp11</code> headers <span class="citation">(Vaughan, Hester, and François 2023)</span>. Unlike existing implementations with <span class="math inline">\(O(n \log(n))\)</span> complexity, such as <span class="citation">Filzmoser, Fritz, and Kalcher (2023)</span>, this implementation also provides dedicated functions to test the statistical significance of the computed correlation, and for which it uses the Gamma function that R already implemented in C <span class="citation">(R Core Team 2024)</span>.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-abrevaya1999">
<p>Abrevaya, Jason. 1999. “Computation of the Maximum Rank Correlation Estimator.” <em>Economics Letters</em> 62 (3): 279–85. <a href="https://doi.org/10.1016/S0165-1765(98)00255-9" class="external-link">https://doi.org/10.1016/S0165-1765(98)00255-9</a>.</p>
</div>
<div id="ref-christensen2005">
<p>Christensen, David. 2005. “Fast Algorithms for the Calculation of Kendall’s <span class="math inline">\(\tau\)</span>.” <em>Computational Statistics</em> 20 (1): 51–62. <a href="https://doi.org/10.1007/BF02736122" class="external-link">https://doi.org/10.1007/BF02736122</a>.</p>
</div>
<div id="ref-emara2024">
<p>Emara, Salma. 2024. “Khufu: Object-Oriented Programming Using C++ — Khufu: Object-Oriented Programming Using C++.” <a href="https://learningcpp.org/cover.html" class="external-link">https://learningcpp.org/cover.html</a>.</p>
</div>
<div id="ref-pcapp">
<p>Filzmoser, Peter, Heinrich Fritz, and Klaudius Kalcher. 2023. <em>PcaPP: Robust Pca by Projection Pursuit</em>. <a href="https://CRAN.R-project.org/package=pcaPP" class="external-link">https://CRAN.R-project.org/package=pcaPP</a>.</p>
</div>
<div id="ref-knight1966">
<p>Knight, William R. 1966. “A Computer Method for Calculating Kendall’s Tau with Ungrouped Data.” <em>Journal of the American Statistical Association</em> 61 (314): 436–39. <a href="https://doi.org/10.1080/01621459.1966.10480879" class="external-link">https://doi.org/10.1080/01621459.1966.10480879</a>.</p>
</div>
<div id="ref-rstats">
<p>R Core Team. 2024. <em>R: A Language and Environment for Statistical Computing</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.</p>
</div>
<div id="ref-santos2006">
<p>Silva, J. M. C. Santos, and Silvana Tenreyro. 2006. “The Log of Gravity.” <em>The Review of Economics and Statistics</em> 88 (4): 641–58. <a href="https://doi.org/10.1162/rest.88.4.641" class="external-link">https://doi.org/10.1162/rest.88.4.641</a>.</p>
</div>
<div id="ref-cpp11">
<p>Vaughan, Davis, Jim Hester, and Romain François. 2023. <em>Cpp11: A C++11 Interface for R’s c Interface</em>. <a href="https://CRAN.R-project.org/package=cpp11" class="external-link">https://CRAN.R-project.org/package=cpp11</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Mauricio Vargas Sepulveda.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
